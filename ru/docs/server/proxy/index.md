# Установка на Прокси

::: tip

Настоятельно рекомендуется сначала прочитать статью [Продвинутая теория](/ru/docs/server/advanced/).

Или *по крайней мере* часть [Терминология](/ru/docs/server/advanced/#терминология).

:::

## Введение

Вы можете использовать Plasmo Voice с Bungee или Velocity двумя разными способами:

- Установить Plasmo Voice на каждый **сервер** за **прокси**.
- Установить Plasmo Voice на **Прокси**, используя плагин Bungee или Velocity.

Первый способ более прост.

Второй способ дает больше возможностей, например:

- Вам нужен только один публичный UDP-порт.
- Вы можете устанавливать дополнения Plasmo Voice на прокси.
  - Например, если вы установите `pv-addon-groups` на прокси, то группы будут работать между серверами.
  - Работает только с теми дополнениями, которые поддерживают эту функцию.

Перед использованием плагина на **Прокси** вам **все еще** нужно установить Plasmo Voice на каждый **сервер** за **Прокси**, поэтому мы начнем с этого.

## Установка на каждый сервер за прокси-сервером

Вы можете следовать обычному руководству по установке.

Просто скачайте плагин и установите его в папку `~/plugins` на каждом из ваших **серверов**.

Кроме того, есть несколько предостережений, которые вы должны иметь в виду.

### Каждый сервер должен иметь свой порт.

Несколько серверов не могут использовать один порт.

Используйте отдельный UDP-порт для каждого **сервера**.

Убедитесь, что каждый порт открыт.

### Прокси и сервер на разных нодах

Если ваши **Proxy** и **Server** расположены на разных **Нодах**, вам нужно изменить **Public IP** в конфигурации Plasmo Voice на **Server**.

::: tip
Больше информации с примером в [Продвинутой теории](/ru/docs/server/advanced/).
:::

```toml
[host]
ip = "0.0.0.0"
port = 0

[host.public]
ip = "222.2.222.222" # IP сервера
port = 2000 # Порт сервера
```

На этом этапе войс чат должен работать. Но вы, возможно, захотите установить плагин **Прокси**, чтобы получить больше возможностей. 

## Установка плагина на Прокси

Сначала скачайте плагин для Bungee или Velocity с сайта [Modrinth](https://modrinth.com/plugin/plasmo-voice/versions), закиньте его в папку `~/plugins` и перезапустите сервер. 

Затем откройте конфиг Plasmo Voice на **прокси**.


```toml
[host]
ip = "0.0.0.0"
port = 0

# [servers]
# farmworld = "127.0.0.1:25565"
# overworld = "127.0.0.1:25566"
```

### Укажите серверы

::: tip
Этот шаг необязателен. Плагин будет использовать конфиг сервера из вашего Bungee/Velocity.

Вам нужно изменить ее только в том случае, если по какой-то причине IP и порт **Войс сервера** не совпадают с IP и портом **Игрового сервера**.
:::

Вы можете отменить `[servers]`, чтобы указать список серверов с Plasmo Voice.

**Ключ** должен совпадать с именем сервера в конфиг Velocity / Bungee.

IP и порты обычно тоже совпадают, но могут быть и другими, если вы настроили их таким образом.

### Укажите Forwarding Secret
В папке `~/plugins/plasmovoice` на **Прокси** появится файл под названием `forwarding-secret`.

Скопируйте этот файл в папки `~/plugins/plasmovoice/` для каждого из **серверов** за прокси.

Вы также можете использовать переменную окружения `PLASMO_VOICE_FORWARDING_SECRET`. Переменная окружения имеет более высокий приоритет, чем файл.

Перезапустите каждый **сервер** после указания **Секрета переадресации**.

### Настройка хоста

Единственный UDP-порт, который должен быть публичным, это тот, который вы задали в конфигурации плагина **Прокси**.

Если вы хотите использовать [DDoS Protection](/ru/docs/server/udp-proxy/), то конфигурация хоста **Proxy** является той, которую вам нужно защитить.

Порты, которые используются плагином **Server** для запуска **Voice Server**, нужны только для связи с **Proxy**. Вам не нужно открывать их для публичного доступа.

Если **Сервер** и **Прокси** находятся на одной **Ноде**, то вам не нужно ничего делать.

Если **Server** и **Proxy** работают на разных **Нодах**, то вы можете настроить свой брандмауэр таким образом, чтобы **Нода** **Сервера** разрешала только UDP трафик от **Ноды** **Прокси**.

