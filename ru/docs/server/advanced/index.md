# Продвинутая теория

## Терминология

- **Нода** — виртуальный или выделенный сервер, на котором могут размещаться серверы и прокси-серверы. Имеет IP-адрес.
- **Прокси** — прокси Velocity или Bungee, работающий на **Ноде**.
- **UDP Прокси** — отдельный прокси-сервер, используемый для перенаправления UDP-трафика.
- **Сервер (Игровой сервер)** — сервер Paper, работающий на **Ноде**.
- **Войс Сервер** — экземпляр **Войс Сервера** запущенный плагином Plasmo Voice на **Игровом сервере**.

## Конфигурация войс сервера

По умолчанию конфигурация плагина настроена следующим образом:

```toml
[host]
ip = "0.0.0.0"
port = 0
```

**IP используется для двух различных целей:**.

- **Адрес привязки** - IP, который плагин будет использовать для запуска голосового сервера. Это всегда должен быть IP **узла**, на котором запущен сервер.
  - Значение по умолчанию `0.0.0.0` означает, что IP будет выведен из IP **ноды**, на которой он запущен. В большинстве случаев менять его не нужно.
- **Публичный адрес** - IP, к которому будет подключаться игрок.
  - Значение по умолчанию `0.0.0.0` означает, что игрок будет пытаться подключиться к тому же IP, который используется для подключения к **Игровому серверу** или **Прокси**. В этом случае могут возникнуть проблемы.
  - Вы можете изменить **публичный адрес** с помощью команды `[host.public]`.

Если порт установлен в 0, то **Войс сервер** будет использовать порт **Сервера**.

Итак, если IP-адрес вашего узла - `111.1.111.111`.

И ваш `server.properties` выглядит следующим образом:

```properties
server-port=25565
```

Конфигурация по умолчанию будет выглядеть так:

```toml
[host]
ip = "111.1.111.111"
port = 25565
```

## Пример

Допустим, у нас есть **Нода A**: `111.1.111.111` и **Нода B**: `222.2.222.222`

Сервера на **Ноде A**:

- **Прокси** `111.1.111.111:1000`.
- **Сервер A** `111.1.111.111:1001`.

Сервера на **Ноде B**:

- **Сервер B** `222.2.222.222:2000`.

При конфигурации по умолчанию игрок будет подключаться к серверу через **Прокси** с IP-адресом `111.1.111.111:1000`.

Когда игрок подключится к **Серверу B**, он попытается установить соединение с **Войс сервером**, используя тот же IP, который он использовал для подключения к **Прокси**.

При настройках по умолчанию это означает, что игрок попытается подключиться к **Войс серверу** на `111.1.111.111:1000`.

Но, это проблема. Так как на самом деле **Войс сервер** работает на `222.2.222.222:2000`.

К счастью, эту проблему можно решить, изменив **Публичный адрес** в конфигурации Plasmo Voice на **Сервере**.

```toml
[host]
ip = "0.0.0.0"
port = 0

[host.public]
ip = "222.2.222.222"
port = 2000
```